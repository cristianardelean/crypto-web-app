trigger: none
 
pool: default
 
variables:
  - name: imageRepo
    value: 'repo-crypto-app'
  - name: dockerfile
    value: 'app/Dockerfile'
  - name: containerRegistry
    value: 'registruaks'
 
stages :
- stage: Build
  displayName: Build and push stage
  jobs: 
  - job: Build
    displayName: Build job
    steps:
    - task: Docker@2
      displayName: Build and push an image to container registry
      inputs:
         command: buildAndPush
         repository: ${{ variables.imageRepo }}
         dockerfile: ${{ variables.dockerfile }}
         containerRegistry: ${{ variables.containerRegistry }}
         tags: |
           $(Build.BuildId)

    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: '$(Pipeline.Workspace)/s/kubernetes'
        artifact: 'manifests'
        publishLocation: 'pipeline'
